#!/bin/sh
set -e

STARTUP="$HOME/startup"
[ -d "/home/lochnerr/startup" ] && STARTUP="/home/lochnerr/startup"
[ -d "../startup" ] && STARTUP="../startup"
[ -d "bootstrap" ] && STARTUP="bootstrap"
echo "Startup dir is: $STARTUP."

echo "" >bootstrap.ks

add_file_stanza() {

  FQN="$1"

  echo "cat >b64 <<-'__EOD__'" >>bootstrap.ks
  cat $FQN | base64 >>bootstrap.ks
  cat >>bootstrap.ks <<-"__EOF__"
	__EOD__

	__EOF__
  echo "/usr/bin/cat b64 | /usr/bin/base64 -d > ${FQN##*/}" >>bootstrap.ks
  echo >>bootstrap.ks
}

add_file_stanza $STARTUP/bin/bootstrap-install
add_file_stanza $STARTUP/bootstrap.service
add_file_stanza $STARTUP/bin/bootstrap-shutdown
add_file_stanza $STARTUP/bin/bootstrap-startup
add_file_stanza $STARTUP/bin/secure-sshd

cat >>bootstrap.ks <<-'__EOF__'
	/usr/bin/rm b64

	/usr/bin/chmod 0755  bootstrap-install
	./bootstrap-install

	systemctl start bootstrap.service
	__EOF__

